#!/bin/sh

if [ "$(id -u)" -ne 0 ]; then
  echo "You must be root."
  exit 1
fi

# Turn off all USB sources
for usb in /sys/bus/usb/devices/*; do
  if [ -w "${usb}/power/wakeup" ]; then
    echo disabled > "${usb}/power/wakeup" || exit 2
  fi
done

# Enabled only user interface devices
for usb in 1-10; do
  if [ -w "/sys/bus/usb/devices/${usb}/power/wakeup" ]; then
    echo enabled > "/sys/bus/usb/devices/${usb}/power/wakeup" || exit 2
  fi
done

grep . /sys/bus/usb/devices/*/power/wakeup || exit 3

exit 0

