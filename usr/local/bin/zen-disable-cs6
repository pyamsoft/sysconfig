#!/bin/sh

if [ "$(id -u)" -eq 0 ]; then
  modprobe msr || {
    printf -- 'Unable to load msr module required by zenstates\n'
    exit 1
  }

  if [ "$1" = "post" ]; then
    if which zenstates > /dev/null 2>&1; then
      # Disable c6 coming out of sleep
      printf -- 'Disable Ryzen C6 state\n'
      exec zenstates --c6-disable
    fi
  fi
fi

